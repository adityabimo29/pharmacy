!function(l){"use strict";var f={storeCountry:function(){f.getCountry().length||l.getJSON(woongkir_params.json.country_url,function(e){e.sort(function(e,t){return e.country_name>t.country_name?1:t.country_name>e.country_name?-1:0}),Lockr.set(woongkir_params.json.country_key,e)})},getCountry:function(e,t){var r=Lockr.get(woongkir_params.json.country_key);return r&&void 0!==r?e&&e===Object(e)?f.searchLocation(r,e,t):r:[]},storeProvince:function(){f.getProvince().length||l.getJSON(woongkir_params.json.province_url,function(e){e.sort(function(e,t){return e.province_name>t.province_name?1:t.province_name>e.province_name?-1:0}),Lockr.set(woongkir_params.json.province_key,e)})},getProvince:function(e,t){var r=Lockr.get(woongkir_params.json.province_key);return r&&void 0!==r?e&&e===Object(e)?f.searchLocation(r,e,t):r:[]},storeCity:function(){f.getCity().length||l.getJSON(woongkir_params.json.city_url,function(e){e.sort(function(e,t){return e.city_name>t.city_name?1:t.city_name>e.city_name?-1:0}),Lockr.set(woongkir_params.json.city_key,e)})},getCity:function(e,t){var r=Lockr.get(woongkir_params.json.city_key);return r&&void 0!==r?e&&e===Object(e)?f.searchLocation(r,e,t):r:[]},storeSubdistrict:function(){f.getSubdistrict().length||l.getJSON(woongkir_params.json.subdistrict_url,function(e){e.sort(function(e,t){return e.subdistrict_name>t.subdistrict_name?1:t.subdistrict_name>e.subdistrict_name?-1:0}),Lockr.set(woongkir_params.json.subdistrict_key,e)})},getSubdistrict:function(e,t){var r=Lockr.get(woongkir_params.json.subdistrict_key);return r&&void 0!==r?e&&e===Object(e)?f.searchLocation(r,e,t):r:[]},searchLocation:function(e,t,r){return"filter"===r?e.filter(function(e){return f.isLocationMatch(e,t)}):e.find(function(e){return f.isLocationMatch(e,t)})},isLocationMatch:function(e,t){var r=!0;for(var n in t)e.hasOwnProperty(n)&&String(e[n]).toLowerCase()===String(t[n]).toLowerCase()||(r=!1);return r}};f.storeCountry(),f.storeProvince(),f.storeCity(),f.storeSubdistrict();var p={addressParams:{},init:function(){if("undefined"==typeof wc_address_i18n_params)return!1;p.bindEvents(),p.toggleForm()},bindEvents:function(){l(document.body).off("country_to_state_changed",p.toggleForm),l(document.body).on("country_to_state_changed",p.toggleForm)},toggleForm:function(){_.each(p.getForms(),function(e){var t=l(e.wrapper);if(t&&t.length){var r=e.prefix;if(!r&&t.find("#billing_country").length&&(r="billing"),!r&&t.find("#shipping_country").length&&(r="shipping"),r){var n=l("#"+r+"_country").val();n&&n.length&&("ID"===n?p.modifyForm(r):p.restoreForm(r,n))}}})},modifyForm:function(i){var o=p.getAddressParams("ID");_.each(["address_2","city"],function(n){var e=l("#"+i+"_"+n);if(!e||!e.length){var t=l("#"+i+"_postcode_field");if(t&&t.length){var r=t.clone().attr({id:i+"_"+n+"_field"});r.find("input").attr({id:i+"_"+n,name:i+"_"+n,value:l("#"+i+"_"+n+"_dummy").val()}),t.before(r),e=r.find("input")}}e&&e.length&&setTimeout(function(){var e=l("#"+i+"_"+n+"_field").find("label"),t=_.has(o[n],"label_class")?o[n].label_class:[];if(e&&e.length){var r=e.html().replace(o[n].label,woongkir_params.text.label[n]);e.html(r),-1!==_.indexOf(t,"screen-reader-text")&&e.removeClass("screen-reader-text")}l("#"+i+"_"+n+"_field").detach().insertAfter(l("#"+i+"_state_field"))},100)}),l(document.body).off("change","#"+i+"_state"),l(document.body).on("change","#"+i+"_state",function(e){p.modifyFormCity(i)}),l(document.body).off("change","#"+i+"_city"),l(document.body).on("change","#"+i+"_city",function(e){p.modifyFormSubdistrict(i)}),l(document.body).off("change","#"+i+"_address_2"),l(document.body).on("change","#"+i+"_address_2",function(e){l(document.body).hasClass("woocommerce-checkout")&&l(document.body).trigger("update_checkout")}),l("#"+i+"_state").trigger("change")},modifyFormCity:function(e){var t=l("#"+e+"_state").val(),r=woongkir_params.text.placeholder.city,n=[{id:"",text:r}],i=l("#"+e+"_city").val(),o=f.getProvince({code:t});if(o){var c=f.getCity({province_id:o.province_id},"filter");if(c)for(var a=0;a<c.length;a++){var s=c[a].type+" "+c[a].city_name;n.push({id:s,text:s,selected:i===s})}}p.convertInputToSelect(e,"city",n,r)},modifyFormSubdistrict:function(e){var t=l("#"+e+"_state").val(),r=l("#"+e+"_city").val(),n=woongkir_params.text.placeholder.address_2,i=[{id:"",text:n}],o=l("#"+e+"_address_2").val(),c=f.getProvince({code:t});if(c){var a=r.split(" ")[0],s=r.split(" ").splice(1).join(" "),d=f.getCity({type:a,city_name:s,province_id:c.province_id});if(d){var _=f.getSubdistrict({province_id:c.province_id,city_id:d.city_id},"filter");if(_)for(var u=0;u<_.length;u++)i.push({id:_[u].subdistrict_name,text:_[u].subdistrict_name,selected:o===_[u].subdistrict_name})}}p.convertInputToSelect(e,"address_2",i,n)},restoreForm:function(t,r){_.each(["city","address_2"],function(e){p.convertSelectToInput(t,e,r),"calc_shipping"===t&&"address_2"===e&&l("#calc_shipping_address_2_field").remove()})},convertInputToSelect:function(e,t,r,n){var i=e+"_"+t,o=l("#"+i);o&&o.length&&(o.is("select")||o.replaceWith(l("<select></select>").attr({id:i,name:i})),o.empty(),o=l("#"+i),_.each(r,function(e){o.append(l("<option></option>").attr({value:e.id}).text(e.text).prop("selected",e.selected))}),o.select2({width:"100%",placeholder:n}).trigger("change"))},convertSelectToInput:function(e,t,r){var n=p.getAddressParams(r),i=e+"_"+t,o=l("#"+i);if(o&&o.length&&o.is("select")){var c=_.has(n,t)?n[t]:{autocomplete:void 0,required:!1,label_class:[]};o.select2("destroy"),o.replaceWith(l("<input>").attr(_.extend({autocomplete:c.autocomplete,required:c.required},{id:i,name:i}))),(o=l("#"+i)).addClass("input-text ");var a=l("#"+e+"_"+t+"_field").find("label");a&&a.length&&-1!==_.indexOf(c.label_class,"screen-reader-text")&&a.addClass("screen-reader-text")}},getForms:function(){return[{wrapper:".woocommerce-billing-fields__field-wrapper",prefix:"billing"},{wrapper:".woocommerce-shipping-fields__field-wrapper",prefix:"shipping"},{wrapper:".shipping-calculator-form",prefix:"calc_shipping"},{wrapper:".woocommerce-address-fields__field-wrapper",prefix:!1}]},getAddressParams:function(e){var t=l.parseJSON(wc_address_i18n_params.locale.replace(/&quot;/g,'"')),r=t.default,n=_.has("addressParams",e)?t[e]:{};return _.extend({},r,n)}};l(document).ready(p.init)}(jQuery);